<div>Step</div>

<h1 class="text-2xl font-bold mb-4">
    {% if step %}
        Edit Step (ID: {{ step.id }})
    {% else %}
        Create Step
    {% endif %}
</h1>
<div>Action = {% if step %}/crud/edit_step/{{ step.id }}{% else %}/crud/create_step{% endif %}</div>

<form
    action="{% if step %}/crud/edit_step/{{ step.id }}{% else %}/crud/create_step{% endif %}"
    method="post"
    class="space-y-4"
>
    <!-- Hidden Fields -->
    <input type="" name="component_id" value="{{ component.id if component else '' }}">
    {% if step %}
        <input type="hidden" name="step_id" value="{{ step.id }}">
    {% endif %}

    <!-- Flex Container for Input Fields and Button -->
    <div class="flex items-center space-x-4">
        <!-- Step Description -->
        <div class="flex-1">
            <label for="description" class="block font-bold">Step Description</label>
            <input
                type="text"
                name="description"
                id="description"
                class="w-full border p-2 rounded"
                value="{{ step.description if step else '' }}"
                required
            >
        </div>

        {% if step %}
            <a href="#" onclick="deleteStep({{ step.id }})" class="text-red-500 mt-4 hover:underline">-verwijder</a>
        {% endif %}

        <!-- Submit Button -->
        <div>
            <button type="submit" class="bg-blue-500 text-white font-bold py-2 px-4 rounded hover:bg-blue-600 h-full">
                {% if step %}
                    Update Step
                {% else %}
                    Create Step
                {% endif %}
            </button>
        </div>
    </div>
</form>

<script>
    
function deleteStep(stepId) {
    console.log(`Attempting to delete step with ID: ${stepId}`);
    if (!stepId) {
        alert("Step ID is missing or invalid.");
        return;
    }

    const url = `/crud/delete_step/${stepId}`;
    console.log(`Constructed URL: ${url}`);

    if (confirm("Are you sure you want to delete this step?")) {
        fetch(url, {
            method: 'DELETE',
            headers: {
                'Content-Type': 'application/json',
            },
        })
        .then(response => {
            if (response.ok) {
                console.log("Step deleted successfully.");
                window.location.reload();
            } else {
                console.error("Failed to delete step. Status:", response.status);
                alert("Error deleting step.");
            }
        })
        .catch(error => {
            console.error("Error occurred during deletion:", error);
            alert("An error occurred while deleting the step.");
        });
    }
}

</script>